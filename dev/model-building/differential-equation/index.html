<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>@DifferentialEquation · NoLimits.jl</title><meta name="title" content="@DifferentialEquation · NoLimits.jl"/><meta property="og:title" content="@DifferentialEquation · NoLimits.jl"/><meta property="twitter:title" content="@DifferentialEquation · NoLimits.jl"/><meta name="description" content="Documentation for NoLimits.jl."/><meta property="og:description" content="Documentation for NoLimits.jl."/><meta property="twitter:description" content="Documentation for NoLimits.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="NoLimits.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation/">Installation</a></li><li><a class="tocitem" href="../../capabilities/">Capabilities</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Model Building</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../model-macro/">@Model</a></li><li><a class="tocitem" href="../helpers/">@helpers</a></li><li><a class="tocitem" href="../fixed-effects/">@fixedEffects</a></li><li><a class="tocitem" href="../covariates/">@covariates</a></li><li><a class="tocitem" href="../random-effects/">@randomEffects</a></li><li><a class="tocitem" href="../pre-differential-equation/">@preDifferentialEquation</a></li><li class="is-active"><a class="tocitem" href>@DifferentialEquation</a><ul class="internal"><li><a class="tocitem" href="#Core-Syntax"><span>Core Syntax</span></a></li><li><a class="tocitem" href="#Parsing-and-Validation-Rules"><span>Parsing and Validation Rules</span></a></li><li><a class="tocitem" href="#Symbol-and-Function-Resolution"><span>Symbol and Function Resolution</span></a></li><li><a class="tocitem" href="#Example:-Standalone-DE-Compilation-and-Evaluation"><span>Example: Standalone DE Compilation and Evaluation</span></a></li><li><a class="tocitem" href="#Example:-Nonlinear-Mixed-Effects-ODE-Model"><span>Example: Nonlinear Mixed-Effects ODE Model</span></a></li><li><a class="tocitem" href="#Example:-Learned-Right-Hand-Side-with-Neural-Networks-and-Soft-Trees"><span>Example: Learned Right-Hand Side with Neural Networks and Soft Trees</span></a></li><li><a class="tocitem" href="#DE-Accessors-for-States-and-Signals"><span>DE Accessors for States and Signals</span></a></li><li><a class="tocitem" href="#Related-APIs"><span>Related APIs</span></a></li></ul></li><li><a class="tocitem" href="../initial-de/">@initialDE</a></li><li><a class="tocitem" href="../formulas/">@formulas</a></li><li><a class="tocitem" href="../universal-function-approximators/">Function Approximators (NNs + SoftTrees)</a></li></ul></li><li><a class="tocitem" href="../../data-model-construction/">Data Model Construction</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Estimation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../estimation/">Overview</a></li><li><a class="tocitem" href="../../estimation/laplace/">Laplace</a></li><li><a class="tocitem" href="../../estimation/laplace-map/">Laplace MAP</a></li><li><a class="tocitem" href="../../estimation/mcem/">MCEM</a></li><li><a class="tocitem" href="../../estimation/saem/">SAEM</a></li><li><a class="tocitem" href="../../estimation/mcmc/">MCMC</a></li><li><a class="tocitem" href="../../estimation/mle/">MLE</a></li><li><a class="tocitem" href="../../estimation/mle-map/">MAP</a></li><li><a class="tocitem" href="../../estimation/multistart/">Multistart</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Uncertainty Quantification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../uncertainty-quantification/">Overview</a></li><li><a class="tocitem" href="../../uncertainty-quantification/wald/">Wald</a></li><li><a class="tocitem" href="../../uncertainty-quantification/profile-likelihood/">Profile likelihood</a></li><li><a class="tocitem" href="../../uncertainty-quantification/mcmc-based-uncertainty/">MCMC-based uncertainty</a></li></ul></li><li><a class="tocitem" href="../../plotting/">Plotting</a></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/mixed-effects-multiple-methods/">Mixed-Effects Tutorial 1: Nonlinear Random-Effects Model Across Multiple Estimation Methods</a></li><li><a class="tocitem" href="../../tutorials/mixed-effects-ode-mcem/">Mixed-Effects Tutorial 2: ODE Model with Dosing Events (MCEM)</a></li><li><a class="tocitem" href="../../tutorials/mixed-effects-nn-saem/">Mixed-Effects Tutorial 3: Neural Differential-Equation Components (SAEM)</a></li><li><a class="tocitem" href="../../tutorials/mixed-effects-softtree-saem/">Mixed-Effects Tutorial 4: SoftTree Differential-Equation Components (SAEM)</a></li><li><a class="tocitem" href="../../tutorials/mixed-effects-seizure-counts-poisson-nb-mcem/">Mixed-Effects Tutorial 5: Seizure Counts with Poisson and NegativeBinomial Outcomes (MCEM)</a></li><li><a class="tocitem" href="../../tutorials/mixed-effects-left-censored-virload50-laplace/">Mixed-Effects Tutorial 6: Left-Censored Nonlinear Model (Laplace)</a></li><li><a class="tocitem" href="../../tutorials/fixed-effects-nonlinear-mle-map/">Fixed-Effects Tutorial 1: Nonlinear Longitudinal Model (MLE + MAP)</a></li></ul></li><li><a class="tocitem" href="../../how-to-contribute/">How to Contribute</a></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Model Building</a></li><li class="is-active"><a href>@DifferentialEquation</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>@DifferentialEquation</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/manuhuth/NoLimits.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/manuhuth/NoLimits.jl/blob/main/docs/src/model-building/differential-equation.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="@DifferentialEquation"><a class="docs-heading-anchor" href="#@DifferentialEquation"><code>@DifferentialEquation</code></a><a id="@DifferentialEquation-1"></a><a class="docs-heading-anchor-permalink" href="#@DifferentialEquation" title="Permalink"></a></h1><p>Many longitudinal processes are naturally described by systems of ordinary differential equations (ODEs). The <code>@DifferentialEquation</code> block specifies the dynamics of such systems, defining how model states evolve over time and optionally declaring derived signals that depend on time and the current state.</p><p>Within <code>@Model</code>, this block is optional. When present, the companion <code>@initialDE</code> block is required to supply initial conditions.</p><h2 id="Core-Syntax"><a class="docs-heading-anchor" href="#Core-Syntax">Core Syntax</a><a id="Core-Syntax-1"></a><a class="docs-heading-anchor-permalink" href="#Core-Syntax" title="Permalink"></a></h2><p>Statements inside <code>@DifferentialEquation</code> take one of two forms:</p><ul><li><strong>State dynamics:</strong> <code>D(state) ~ rhs_expression</code> – defines the time derivative of a state variable.</li><li><strong>Derived signals:</strong> <code>signal(t) = expression</code> (or <code>signal(\xi) = expression</code>) – defines an auxiliary quantity computed within the ODE, useful for intermediate calculations that appear in multiple state equations.</li></ul><pre><code class="language-julia hljs">de = @DifferentialEquation begin
    s(t) = sin(t)
    D(x1) ~ -a * x1 + s(t)
    D(x2) ~ a * x1 - b * x2
end</code></pre><p>The ordering of <code>D(state)</code> declarations determines the state indexing in the solver&#39;s <code>u</code> and <code>du</code> vectors.</p><h2 id="Parsing-and-Validation-Rules"><a class="docs-heading-anchor" href="#Parsing-and-Validation-Rules">Parsing and Validation Rules</a><a id="Parsing-and-Validation-Rules-1"></a><a class="docs-heading-anchor-permalink" href="#Parsing-and-Validation-Rules" title="Permalink"></a></h2><p>The following constraints are enforced at parse time:</p><ul><li>The block must be wrapped in <code>begin ... end</code>.</li><li>Only <code>D(state) ~ expr</code> and <code>signal(t) = expr</code> / <code>signal(\xi) = expr</code> forms are permitted.</li><li>State names and signal names must be unique across the block.</li><li><code>D(...)</code> must contain exactly one symbolic state name.</li><li>Derived signals must always be referenced as function calls (<code>s(t)</code> or <code>s(\xi)</code>), never as bare symbols (<code>s</code>).</li><li>Unresolved symbols or functions in DE expressions raise an error during compilation.</li></ul><h2 id="Symbol-and-Function-Resolution"><a class="docs-heading-anchor" href="#Symbol-and-Function-Resolution">Symbol and Function Resolution</a><a id="Symbol-and-Function-Resolution-1"></a><a class="docs-heading-anchor-permalink" href="#Symbol-and-Function-Resolution" title="Permalink"></a></h2><p>NoLimits resolves symbols appearing in DE expressions from the following sources:</p><p><strong>Variable-like symbols</strong> are drawn from:</p><ul><li>Fixed effects</li><li>Random effects</li><li>Constant covariates</li><li>PreDE outputs (<code>@preDifferentialEquation</code>)</li></ul><p><strong>Function-like calls</strong> are drawn from:</p><ul><li>Dynamic covariates (e.g., <code>w(t)</code>)</li><li>Helper functions (<code>@helpers</code>)</li><li>Model functions from learned parameter blocks (e.g., neural network, soft tree, or spline functions)</li></ul><p>Note that time-varying (non-dynamic) covariates are not available inside the ODE, since their values are defined only at observation times. Use dynamic covariates with an appropriate interpolation method for continuous-time access.</p><h2 id="Example:-Standalone-DE-Compilation-and-Evaluation"><a class="docs-heading-anchor" href="#Example:-Standalone-DE-Compilation-and-Evaluation">Example: Standalone DE Compilation and Evaluation</a><a id="Example:-Standalone-DE-Compilation-and-Evaluation-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Standalone-DE-Compilation-and-Evaluation" title="Permalink"></a></h2><p>The <code>@DifferentialEquation</code> macro can be used outside of <code>@Model</code> for testing or prototyping. The following demonstrates direct compilation and evaluation of a single-state ODE.</p><pre><code class="language-julia hljs">using NoLimits
using ComponentArrays

de = @DifferentialEquation begin
    s(t) = sin(t)
    D(x1) ~ -a * x1^2 + s(t) + w(t) + pre
end

ctx = (
    fixed_effects = ComponentArray(a = 0.3),
    random_effects = ComponentArray(),
    constant_covariates = NamedTuple(),
    varying_covariates = (w = t -&gt; 0.2 * t,),
    helpers = NamedTuple(),
    model_funs = NamedTuple(),
    preDE = (pre = 0.5,),
)

pc = get_de_compiler(de)(ctx)
u = [1.0]
du = similar(u)
get_de_f!(de)(du, u, pc, 0.4)</code></pre><h2 id="Example:-Nonlinear-Mixed-Effects-ODE-Model"><a class="docs-heading-anchor" href="#Example:-Nonlinear-Mixed-Effects-ODE-Model">Example: Nonlinear Mixed-Effects ODE Model</a><a id="Example:-Nonlinear-Mixed-Effects-ODE-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Nonlinear-Mixed-Effects-ODE-Model" title="Permalink"></a></h2><p>This example illustrates a complete model in which random effects enter both the ODE dynamics and the observation distribution. The derived signal <code>s(t)</code> encapsulates a nonlinear transformation of a dynamic covariate and a preDE quantity, keeping the state equation concise.</p><pre><code class="language-julia hljs">using NoLimits
using Distributions

model = @Model begin
    @helpers begin
        sat(u) = u / (1 + abs(u))
    end

    @fixedEffects begin
        a = RealNumber(0.4)
        b = RealNumber(0.2)
        sigma = RealNumber(0.3, scale=:log)
    end

    @covariates begin
        t = Covariate()
        w = DynamicCovariate()
    end

    @randomEffects begin
        eta = RandomEffect(TDist(6.0); column=:ID)
    end

    @preDifferentialEquation begin
        pre = exp(a + eta^2)
    end

    @DifferentialEquation begin
        s(t) = sat(w(t) + pre)
        D(x1) ~ -(b + tanh(eta)) * x1 + s(t)^2
    end

    @initialDE begin
        x1 = pre
    end

    @formulas begin
        y ~ Normal(log1p(abs(x1(t)) + eta^2), sigma)
    end
end</code></pre><h2 id="Example:-Learned-Right-Hand-Side-with-Neural-Networks-and-Soft-Trees"><a class="docs-heading-anchor" href="#Example:-Learned-Right-Hand-Side-with-Neural-Networks-and-Soft-Trees">Example: Learned Right-Hand Side with Neural Networks and Soft Trees</a><a id="Example:-Learned-Right-Hand-Side-with-Neural-Networks-and-Soft-Trees-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Learned-Right-Hand-Side-with-Neural-Networks-and-Soft-Trees" title="Permalink"></a></h2><p>When the functional form of the ODE right-hand side is unknown or difficult to specify mechanistically, learned components such as neural networks and soft decision trees can be embedded directly into the dynamics. In this example, the transfer and elimination rates of a two-state system are parameterized by neural networks and soft trees, with individual-level random effects on the learned parameters.</p><pre><code class="language-julia hljs">using NoLimits
using Distributions
using Lux
using LinearAlgebra

chain_A1 = Chain(Dense(1, 4, tanh), Dense(4, 1))
chain_A2 = Chain(Dense(1, 4, tanh), Dense(4, 1))
depth_st = 2

model = @Model begin
    @helpers begin
        softplus(u) = u &gt; 20 ? u : log1p(exp(u))
    end

    @covariates begin
        t = Covariate()
        d = ConstantCovariate(; constant_on=:ID)
    end

    @fixedEffects begin
        sigma = RealNumber(0.3, scale=:log)

        zA1 = NNParameters(chain_A1; function_name=:NNA1, calculate_se=false)
        zA2 = NNParameters(chain_A2; function_name=:NNA2, calculate_se=false)
        gC1 = SoftTreeParameters(1, depth_st; function_name=:STC1, calculate_se=false)
        gC2 = SoftTreeParameters(1, depth_st; function_name=:STC2, calculate_se=false)
    end

    @randomEffects begin
        etaA1 = RandomEffect(MvNormal(zA1, Diagonal(ones(length(zA1)))); column=:ID)
        etaA2 = RandomEffect(MvNormal(zA2, Diagonal(ones(length(zA2)))); column=:ID)
        etaC1 = RandomEffect(MvNormal(gC1, Diagonal(ones(length(gC1)))); column=:ID)
        etaC2 = RandomEffect(MvNormal(gC2, Diagonal(ones(length(gC2)))); column=:ID)
    end

    @DifferentialEquation begin
        a_A(t) = softplus(depot)
        x_C(t) = softplus(center)

        fA1(t) = softplus(NNA1([t / 24], etaA1)[1])
        fA2(t) = softplus(NNA2([a_A(t)], etaA2)[1])
        fC1(t) = -softplus(STC1([x_C(t)], etaC1)[1])
        fC2(t) = softplus(STC2([t / 24], etaC2)[1])

        D(depot) ~ -d * fA1(t) - fA2(t)
        D(center) ~ d * fA1(t) + fA2(t) + fC1(t) + d * fC2(t)
    end

    @initialDE begin
        depot = d
        center = 0.0
    end

    @formulas begin
        y ~ LogNormal(center(t), sigma)
    end
end</code></pre><h2 id="DE-Accessors-for-States-and-Signals"><a class="docs-heading-anchor" href="#DE-Accessors-for-States-and-Signals">DE Accessors for States and Signals</a><a id="DE-Accessors-for-States-and-Signals-1"></a><a class="docs-heading-anchor-permalink" href="#DE-Accessors-for-States-and-Signals" title="Permalink"></a></h2><p>After ODE integration, accessor functions provide callable trajectories for each state and derived signal. These are the same accessors that formula evaluation uses internally when outcomes reference <code>x1(t)</code> or <code>s(t)</code>.</p><pre><code class="language-julia hljs">if @isdefined(sol) &amp;&amp; @isdefined(compiled_de_context)
    accessors = get_de_accessors_builder(model.de.de)(sol, compiled_de_context)

    x1_at_12 = accessors.x1(1.2)
    s_at_12 = accessors.s(1.2)
end</code></pre><h2 id="Related-APIs"><a class="docs-heading-anchor" href="#Related-APIs">Related APIs</a><a id="Related-APIs-1"></a><a class="docs-heading-anchor-permalink" href="#Related-APIs" title="Permalink"></a></h2><p>The following functions provide lower-level access to the DE subsystem:</p><ul><li><code>get_de_states(de)</code> and <code>get_de_signals(de)</code> – enumerate declared states and signals.</li><li><code>get_de_compiler(de)</code>, <code>get_de_f!(de)</code>, <code>get_de_f(de)</code> – access the compiled ODE function and its context builder.</li><li><code>get_de_accessors_builder(de)</code> – returns a function that constructs solution accessors from an ODE solution.</li><li><code>build_de_params(de, \theta; ...)</code> – assembles ODE parameters with tunable modes (<code>:theta</code>, <code>:eta</code>, <code>:both</code>).</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../pre-differential-equation/">« @preDifferentialEquation</a><a class="docs-footer-nextpage" href="../initial-de/">@initialDE »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 20 February 2026 09:14">Friday 20 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
