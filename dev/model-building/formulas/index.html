<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>@formulas · NoLimits.jl</title><meta name="title" content="@formulas · NoLimits.jl"/><meta property="og:title" content="@formulas · NoLimits.jl"/><meta property="twitter:title" content="@formulas · NoLimits.jl"/><meta name="description" content="Documentation for NoLimits.jl."/><meta property="og:description" content="Documentation for NoLimits.jl."/><meta property="twitter:description" content="Documentation for NoLimits.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="NoLimits.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation/">Installation</a></li><li><a class="tocitem" href="../../capabilities/">Capabilities</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox" checked/><label class="tocitem" for="menuitem-4"><span class="docs-label">Model Building</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../">Overview</a></li><li><a class="tocitem" href="../model-macro/">@Model</a></li><li><a class="tocitem" href="../helpers/">@helpers</a></li><li><a class="tocitem" href="../fixed-effects/">@fixedEffects</a></li><li><a class="tocitem" href="../covariates/">@covariates</a></li><li><a class="tocitem" href="../random-effects/">@randomEffects</a></li><li><a class="tocitem" href="../pre-differential-equation/">@preDifferentialEquation</a></li><li><a class="tocitem" href="../differential-equation/">@DifferentialEquation</a></li><li><a class="tocitem" href="../initial-de/">@initialDE</a></li><li class="is-active"><a class="tocitem" href>@formulas</a><ul class="internal"><li><a class="tocitem" href="#Core-Syntax"><span>Core Syntax</span></a></li><li><a class="tocitem" href="#Parsing-and-Validation-Rules"><span>Parsing and Validation Rules</span></a></li><li><a class="tocitem" href="#Symbol-Resolution-and-Namespace-Rules"><span>Symbol Resolution and Namespace Rules</span></a></li><li><a class="tocitem" href="#State-and-Signal-Access-from-ODE-Models"><span>State and Signal Access from ODE Models</span></a></li><li><a class="tocitem" href="#Time-Offsets-in-State-and-Signal-Calls"><span>Time Offsets in State and Signal Calls</span></a></li><li><a class="tocitem" href="#Example:-Multiple-Deterministic-Nodes-and-Outcomes"><span>Example: Multiple Deterministic Nodes and Outcomes</span></a></li><li><a class="tocitem" href="#Example:-Helper-Functions-and-Learned-Model-Functions"><span>Example: Helper Functions and Learned Model Functions</span></a></li><li><a class="tocitem" href="#Example:-ODE-State-and-Signal-Access"><span>Example: ODE State and Signal Access</span></a></li><li><a class="tocitem" href="#Example:-Hidden-Markov-Observation-Model"><span>Example: Hidden Markov Observation Model</span></a></li><li><a class="tocitem" href="#Example:-Multivariate-Hidden-Markov-Observation-Model"><span>Example: Multivariate Hidden Markov Observation Model</span></a></li><li><a class="tocitem" href="#Related-APIs"><span>Related APIs</span></a></li></ul></li><li><a class="tocitem" href="../universal-function-approximators/">Function Approximators (NNs + SoftTrees)</a></li></ul></li><li><a class="tocitem" href="../../data-model-construction/">Data Model Construction</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Estimation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../estimation/">Overview</a></li><li><a class="tocitem" href="../../estimation/laplace/">Laplace</a></li><li><a class="tocitem" href="../../estimation/laplace-map/">Laplace MAP</a></li><li><a class="tocitem" href="../../estimation/mcem/">MCEM</a></li><li><a class="tocitem" href="../../estimation/saem/">SAEM</a></li><li><a class="tocitem" href="../../estimation/mcmc/">MCMC</a></li><li><a class="tocitem" href="../../estimation/vi/">VI</a></li><li><a class="tocitem" href="../../estimation/mle/">MLE</a></li><li><a class="tocitem" href="../../estimation/mle-map/">MAP</a></li><li><a class="tocitem" href="../../estimation/multistart/">Multistart</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Uncertainty Quantification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../uncertainty-quantification/">Overview</a></li><li><a class="tocitem" href="../../uncertainty-quantification/wald/">Wald</a></li><li><a class="tocitem" href="../../uncertainty-quantification/profile-likelihood/">Profile likelihood</a></li><li><a class="tocitem" href="../../uncertainty-quantification/mcmc-based-uncertainty/">MCMC-based uncertainty</a></li></ul></li><li><a class="tocitem" href="../../plotting/">Plotting</a></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox"/><label class="tocitem" for="menuitem-9"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../tutorials/mixed-effects-multiple-methods/">Mixed-Effects Tutorial 1: Nonlinear Random-Effects Model Across Multiple Estimation Methods</a></li><li><a class="tocitem" href="../../tutorials/mixed-effects-ode-mcem/">Mixed-Effects Tutorial 2: ODE Model with Dosing Events (MCEM)</a></li><li><a class="tocitem" href="../../tutorials/mixed-effects-nn-saem/">Mixed-Effects Tutorial 3: Neural Differential-Equation Components (SAEM)</a></li><li><a class="tocitem" href="../../tutorials/mixed-effects-softtree-saem/">Mixed-Effects Tutorial 4: SoftTree Differential-Equation Components (SAEM)</a></li><li><a class="tocitem" href="../../tutorials/mixed-effects-seizure-counts-poisson-nb-mcem/">Mixed-Effects Tutorial 5: Seizure Counts with Poisson and NegativeBinomial Outcomes (MCEM)</a></li><li><a class="tocitem" href="../../tutorials/mixed-effects-left-censored-virload50-laplace/">Mixed-Effects Tutorial 6: Left-Censored Nonlinear Model (Laplace)</a></li><li><a class="tocitem" href="../../tutorials/mixed-effects-vi/">Mixed-Effects Tutorial 7: Variational Inference (VI)</a></li><li><a class="tocitem" href="../../tutorials/fixed-effects-nonlinear-mle-map/">Fixed-Effects Tutorial 1: Nonlinear Longitudinal Model (MLE + MAP)</a></li><li><a class="tocitem" href="../../tutorials/fixed-effects-vi/">Fixed-Effects Tutorial 2: Variational Inference (VI)</a></li></ul></li><li><a class="tocitem" href="../../how-to-contribute/">How to Contribute</a></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Model Building</a></li><li class="is-active"><a href>@formulas</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>@formulas</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/manuhuth/NoLimits.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/manuhuth/NoLimits.jl/blob/main/docs/src/model-building/formulas.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="@formulas"><a class="docs-heading-anchor" href="#@formulas"><code>@formulas</code></a><a id="@formulas-1"></a><a class="docs-heading-anchor-permalink" href="#@formulas" title="Permalink"></a></h1><p>The <code>@formulas</code> block specifies the observation model that links latent quantities to measured data. It defines deterministic intermediate expressions and the statistical distributions assumed for each observed outcome. Within <code>@Model</code>, this block is required.</p><h2 id="Core-Syntax"><a class="docs-heading-anchor" href="#Core-Syntax">Core Syntax</a><a id="Core-Syntax-1"></a><a class="docs-heading-anchor-permalink" href="#Core-Syntax" title="Permalink"></a></h2><p>Two statement forms are supported inside <code>@formulas</code>:</p><ul><li><strong>Deterministic assignment:</strong> <code>name = expression</code> defines an intermediate quantity computed from model components.</li><li><strong>Observation definition:</strong> <code>name ~ distribution_expression</code> declares a likelihood contribution for a named outcome column.</li></ul><pre><code class="language-julia hljs">form = @formulas begin
    lin = a + eta^2 + x.Age
    y ~ Laplace(lin, sigma)
end</code></pre><h2 id="Parsing-and-Validation-Rules"><a class="docs-heading-anchor" href="#Parsing-and-Validation-Rules">Parsing and Validation Rules</a><a id="Parsing-and-Validation-Rules-1"></a><a class="docs-heading-anchor-permalink" href="#Parsing-and-Validation-Rules" title="Permalink"></a></h2><p>The macro enforces the following constraints at model-construction time:</p><ul><li>The block must use <code>begin ... end</code> syntax.</li><li>Only assignments (<code>=</code>) and observation statements (<code>~</code>) are permitted.</li><li>The left-hand side of each statement must be a plain symbol.</li><li>The reserved symbols <code>t</code> and <code>ξ</code> cannot appear on the left-hand side.</li><li>Duplicate names within deterministic definitions, within observation definitions, or across both categories are rejected.</li></ul><h2 id="Symbol-Resolution-and-Namespace-Rules"><a class="docs-heading-anchor" href="#Symbol-Resolution-and-Namespace-Rules">Symbol Resolution and Namespace Rules</a><a id="Symbol-Resolution-and-Namespace-Rules-1"></a><a class="docs-heading-anchor-permalink" href="#Symbol-Resolution-and-Namespace-Rules" title="Permalink"></a></h2><p>Expressions inside <code>@formulas</code> can reference symbols drawn from several model namespaces:</p><ul><li>Fixed effects</li><li>Random effects</li><li>PreDE outputs</li><li>Constant covariates</li><li>Varying covariates</li><li>Helper functions (<code>@helpers</code>)</li><li>Model functions from learned parameter blocks (e.g., neural networks, soft trees)</li></ul><p>If a symbol name is shared across more than one namespace among fixed effects, random effects, preDE outputs, and covariates, the macro raises an ambiguity error to prevent silent resolution conflicts.</p><h2 id="State-and-Signal-Access-from-ODE-Models"><a class="docs-heading-anchor" href="#State-and-Signal-Access-from-ODE-Models">State and Signal Access from ODE Models</a><a id="State-and-Signal-Access-from-ODE-Models-1"></a><a class="docs-heading-anchor-permalink" href="#State-and-Signal-Access-from-ODE-Models" title="Permalink"></a></h2><p>When the model includes a differential equation system, ODE states and derived signals can be referenced in formulas subject to the following rules:</p><ul><li>States and signals must be called with an explicit time argument, e.g., <code>x1(t)</code> or <code>s(t)</code>.</li><li>Bare references without a time argument (e.g., <code>x1</code>, <code>s</code>) are rejected.</li><li>The set of required states and signals is inferred automatically and stored as <code>required_states</code> and <code>required_signals</code>.</li></ul><p>At runtime, formulas that depend on ODE outputs receive solution accessor functions generated by <code>get_de_accessors_builder(...)</code>.</p><h2 id="Time-Offsets-in-State-and-Signal-Calls"><a class="docs-heading-anchor" href="#Time-Offsets-in-State-and-Signal-Calls">Time Offsets in State and Signal Calls</a><a id="Time-Offsets-in-State-and-Signal-Calls-1"></a><a class="docs-heading-anchor-permalink" href="#Time-Offsets-in-State-and-Signal-Calls" title="Permalink"></a></h2><p>Formulas support constant time offsets when accessing ODE states and signals, enabling evaluation at shifted time points:</p><ul><li><code>x1(t + 0.25)</code></li><li><code>x1(t - 0.5)</code></li><li><code>x1(t + (1/4))</code></li></ul><p>These offsets are exposed through <code>get_formulas_time_offsets(...)</code> and handled automatically during <code>DataModel</code> construction:</p><ul><li>Constant offsets extend the integration window and save grid as needed.</li><li>Negative offsets that would require evaluation before the start of an individual&#39;s trajectory are rejected.</li><li>Non-constant offsets (e.g., expressions involving covariates) require dense ODE solving mode.</li></ul><h2 id="Example:-Multiple-Deterministic-Nodes-and-Outcomes"><a class="docs-heading-anchor" href="#Example:-Multiple-Deterministic-Nodes-and-Outcomes">Example: Multiple Deterministic Nodes and Outcomes</a><a id="Example:-Multiple-Deterministic-Nodes-and-Outcomes-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Multiple-Deterministic-Nodes-and-Outcomes" title="Permalink"></a></h2><p>The following model illustrates the use of multiple intermediate deterministic expressions feeding into two distinct outcome distributions.</p><pre><code class="language-julia hljs">using NoLimits
using Distributions

model = @Model begin
    @fixedEffects begin
        a = RealNumber(0.2)
        b = RealNumber(0.1)
        s1 = RealNumber(0.3, scale=:log)
        s2 = RealNumber(0.4, scale=:log)
    end

    @covariates begin
        t = Covariate()
        x = ConstantCovariateVector([:Age, :BMI]; constant_on=:ID)
    end

    @randomEffects begin
        eta = RandomEffect(TDist(6.0); column=:ID)
    end

    @formulas begin
        d1 = a + 0.01 * x.Age^2 + tanh(eta)
        d2 = d1 + b * log1p(x.BMI^2) + eta^2
        y1 ~ LogNormal(d2, s1)
        y2 ~ Gamma(d1^2 + abs(eta) + 1e-6, s2)
    end
end</code></pre><h2 id="Example:-Helper-Functions-and-Learned-Model-Functions"><a class="docs-heading-anchor" href="#Example:-Helper-Functions-and-Learned-Model-Functions">Example: Helper Functions and Learned Model Functions</a><a id="Example:-Helper-Functions-and-Learned-Model-Functions-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Helper-Functions-and-Learned-Model-Functions" title="Permalink"></a></h2><p>User-defined helpers and learned parameter blocks (such as neural networks) can be called directly within formula expressions.</p><pre><code class="language-julia hljs">using NoLimits
using Distributions
using Lux

chain = Chain(Dense(2, 4, tanh), Dense(4, 1))

model = @Model begin
    @helpers begin
        softplus(u) = log1p(exp(u))
    end

    @fixedEffects begin
        sigma = RealNumber(0.4, scale=:log)
        z = NNParameters(chain; function_name=:NN1, calculate_se=false)
    end

    @covariates begin
        t = Covariate()
        x = ConstantCovariateVector([:Age, :BMI]; constant_on=:ID)
    end

    @randomEffects begin
        eta = RandomEffect(SkewNormal(0.0, 1.0, 0.8); column=:ID)
    end

    @formulas begin
        lin = NN1([x.Age, x.BMI], z)[1] + softplus(eta^2)
        y ~ Gamma(lin + 1e-6, sigma)
    end
end</code></pre><h2 id="Example:-ODE-State-and-Signal-Access"><a class="docs-heading-anchor" href="#Example:-ODE-State-and-Signal-Access">Example: ODE State and Signal Access</a><a id="Example:-ODE-State-and-Signal-Access-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-ODE-State-and-Signal-Access" title="Permalink"></a></h2><p>When a model includes <code>@DifferentialEquation</code>, states and derived signals are accessed in formulas using explicit time arguments. Time offsets such as <code>x1(t + 0.25)</code> enable evaluation at shifted time points.</p><pre><code class="language-julia hljs">using NoLimits
using Distributions

model = @Model begin
    @fixedEffects begin
        a = RealNumber(0.2)
        sigma = RealNumber(0.3, scale=:log)
    end

    @covariates begin
        t = Covariate()
    end

    @DifferentialEquation begin
        s(t) = sin(t)
        D(x1) ~ -a * x1 + s(t)
    end

    @initialDE begin
        x1 = 1.0
    end

    @formulas begin
        mu = x1(t) + s(t) + x1(t + 0.25)
        y ~ Exponential(log1p(abs(mu)) + 1e-6)
    end
end</code></pre><h2 id="Example:-Hidden-Markov-Observation-Model"><a class="docs-heading-anchor" href="#Example:-Hidden-Markov-Observation-Model">Example: Hidden Markov Observation Model</a><a id="Example:-Hidden-Markov-Observation-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Hidden-Markov-Observation-Model" title="Permalink"></a></h2><p>For data generated by regime-switching processes, <code>@formulas</code> supports hidden Markov model likelihoods via <code>ContinuousTimeDiscreteStatesHMM</code>. The transition rate matrix, per-state emission distributions, initial state distribution, and inter-observation time intervals are specified directly.</p><pre><code class="language-julia hljs">using NoLimits
using Distributions

model = @Model begin
    @fixedEffects begin
        λ12 = RealNumber(0.2, scale=:log)
        λ21 = RealNumber(0.3, scale=:log)
        p1 = RealNumber(0.25)
        p2 = RealNumber(0.75)
    end

    @covariates begin
        t = Covariate()
        delta_t = Covariate()
    end

    @formulas begin
        outcome ~ ContinuousTimeDiscreteStatesHMM(
            [-λ12  λ12;
              λ21 -λ21],
            (Bernoulli(p1), Bernoulli(p2)),
            Categorical([0.6, 0.4]),
            delta_t
        )
    end
end</code></pre><h2 id="Example:-Multivariate-Hidden-Markov-Observation-Model"><a class="docs-heading-anchor" href="#Example:-Multivariate-Hidden-Markov-Observation-Model">Example: Multivariate Hidden Markov Observation Model</a><a id="Example:-Multivariate-Hidden-Markov-Observation-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Example:-Multivariate-Hidden-Markov-Observation-Model" title="Permalink"></a></h2><p>When each observation consists of several outcome variables that share the same hidden state, use <code>MVDiscreteTimeDiscreteStatesHMM</code> or <code>MVContinuousTimeDiscreteStatesHMM</code>. The observable column in the DataFrame should contain <code>Vector{&lt;:Real}</code> values, one vector per observation time.</p><p>Two emission modes are supported:</p><ul><li><strong>Conditionally independent</strong>: the emission for state <code>k</code> is a <code>Tuple</code> of M scalar distributions, one per outcome. Missing entries in the observation vector are skipped (contribute zero log-likelihood).</li><li><strong>Joint <code>MvNormal</code></strong>: the emission for state <code>k</code> is a single <code>MvNormal</code>. Partial missings are handled by marginalising analytically over the observed indices.</li></ul><h3 id="Discrete-time,-conditionally-independent-emissions"><a class="docs-heading-anchor" href="#Discrete-time,-conditionally-independent-emissions">Discrete time, conditionally independent emissions</a><a id="Discrete-time,-conditionally-independent-emissions-1"></a><a class="docs-heading-anchor-permalink" href="#Discrete-time,-conditionally-independent-emissions" title="Permalink"></a></h3><p>The transition matrix is row-stochastic (each row sums to one). The outer <code>Tuple</code> contains one inner <code>Tuple</code> of scalar distributions per state.</p><pre><code class="language-julia hljs">using NoLimits
using Distributions

model = @Model begin
    @fixedEffects begin
        p12   = RealNumber(0.3)
        p21   = RealNumber(0.2)
        mu1   = RealNumber(1.0)
        mu2   = RealNumber(3.0)
        sigma = RealNumber(0.5, scale=:log)
    end

    @covariates begin
        t = Covariate()
    end

    @formulas begin
        outcome ~ MVDiscreteTimeDiscreteStatesHMM(
            [1-p12  p12;
              p21  1-p21],
            (
                (Normal(mu1, sigma), Bernoulli(0.2)),  # state 1: (continuous, binary)
                (Normal(mu2, sigma), Bernoulli(0.8)),  # state 2: (continuous, binary)
            ),
            Categorical([0.5, 0.5])
        )
    end
end</code></pre><p>The <code>outcome</code> column in the DataFrame must hold two-element vectors (one <code>Float64</code> and one <code>0.0</code>/<code>1.0</code>) matching the M=2 outcomes declared by the emission tuples.</p><h3 id="Continuous-time,-joint-MvNormal-emissions"><a class="docs-heading-anchor" href="#Continuous-time,-joint-MvNormal-emissions">Continuous time, joint MvNormal emissions</a><a id="Continuous-time,-joint-MvNormal-emissions-1"></a><a class="docs-heading-anchor-permalink" href="#Continuous-time,-joint-MvNormal-emissions" title="Permalink"></a></h3><p>The transition matrix is a rate matrix (generator): off-diagonal entries ≥ 0, each row sums to zero. State propagation uses the matrix exponential <code>exp(Q · Δt)</code>. Joint <code>MvNormal</code> emissions enable full cross-outcome correlation within each state.</p><pre><code class="language-julia hljs">using NoLimits
using Distributions
using LinearAlgebra

model = @Model begin
    @fixedEffects begin
        lambda12 = RealNumber(0.2, scale=:log)
        lambda21 = RealNumber(0.3, scale=:log)
        mu1      = RealNumber(0.0)
        mu2      = RealNumber(2.0)
    end

    @covariates begin
        t       = Covariate()
        delta_t = Covariate()
    end

    @formulas begin
        outcome ~ MVContinuousTimeDiscreteStatesHMM(
            [-lambda12  lambda12;
              lambda21 -lambda21],
            (
                MvNormal([mu1, mu1], I(2)),
                MvNormal([mu2, mu2], I(2)),
            ),
            Categorical([0.5, 0.5]),
            delta_t
        )
    end
end</code></pre><p>Here <code>delta_t</code> is a time-varying covariate holding the elapsed time since the previous observation for each row. The <code>outcome</code> column must hold two-element vectors matching the dimension of the <code>MvNormal</code> emissions. Partially-missing vectors (e.g. <code>[1.2, missing]</code>) are handled by marginalising the <code>MvNormal</code> over the observed index.</p><h2 id="Related-APIs"><a class="docs-heading-anchor" href="#Related-APIs">Related APIs</a><a id="Related-APIs-1"></a><a class="docs-heading-anchor-permalink" href="#Related-APIs" title="Permalink"></a></h2><p>The following functions provide programmatic access to the internal representation and evaluation of formulas:</p><ul><li><code>get_formulas_meta(formulas)</code></li><li><code>get_formulas_ir(formulas)</code></li><li><code>get_formulas_builders(formulas; ...)</code></li><li><code>get_formulas_all(formulas, ctx, sol_accessors, constant_covariates_i, varying_covariates; ...)</code></li><li><code>get_formulas_obs(formulas, ctx, sol_accessors, constant_covariates_i, varying_covariates; ...)</code></li><li><code>get_formulas_time_offsets(formulas, state_names, signal_names)</code></li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../initial-de/">« @initialDE</a><a class="docs-footer-nextpage" href="../universal-function-approximators/">Function Approximators (NNs + SoftTrees) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.17.0 on <span class="colophon-date" title="Saturday 21 February 2026 16:41">Saturday 21 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
