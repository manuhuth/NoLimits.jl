<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mixed-Effects Tutorial 7: Variational Inference (VI) · NoLimits.jl</title><meta name="title" content="Mixed-Effects Tutorial 7: Variational Inference (VI) · NoLimits.jl"/><meta property="og:title" content="Mixed-Effects Tutorial 7: Variational Inference (VI) · NoLimits.jl"/><meta property="twitter:title" content="Mixed-Effects Tutorial 7: Variational Inference (VI) · NoLimits.jl"/><meta name="description" content="Documentation for NoLimits.jl."/><meta property="og:description" content="Documentation for NoLimits.jl."/><meta property="twitter:description" content="Documentation for NoLimits.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="NoLimits.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation/">Installation</a></li><li><a class="tocitem" href="../../capabilities/">Capabilities</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Model Building</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model-building/">Overview</a></li><li><a class="tocitem" href="../../model-building/model-macro/">@Model</a></li><li><a class="tocitem" href="../../model-building/helpers/">@helpers</a></li><li><a class="tocitem" href="../../model-building/fixed-effects/">@fixedEffects</a></li><li><a class="tocitem" href="../../model-building/covariates/">@covariates</a></li><li><a class="tocitem" href="../../model-building/random-effects/">@randomEffects</a></li><li><a class="tocitem" href="../../model-building/pre-differential-equation/">@preDifferentialEquation</a></li><li><a class="tocitem" href="../../model-building/differential-equation/">@DifferentialEquation</a></li><li><a class="tocitem" href="../../model-building/initial-de/">@initialDE</a></li><li><a class="tocitem" href="../../model-building/formulas/">@formulas</a></li><li><a class="tocitem" href="../../model-building/universal-function-approximators/">Function Approximators (NNs + SoftTrees)</a></li></ul></li><li><a class="tocitem" href="../../data-model-construction/">Data Model Construction</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Estimation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../estimation/">Overview</a></li><li><a class="tocitem" href="../../estimation/laplace/">Laplace</a></li><li><a class="tocitem" href="../../estimation/laplace-map/">Laplace MAP</a></li><li><a class="tocitem" href="../../estimation/mcem/">MCEM</a></li><li><a class="tocitem" href="../../estimation/saem/">SAEM</a></li><li><a class="tocitem" href="../../estimation/mcmc/">MCMC</a></li><li><a class="tocitem" href="../../estimation/vi/">VI</a></li><li><a class="tocitem" href="../../estimation/mle/">MLE</a></li><li><a class="tocitem" href="../../estimation/mle-map/">MAP</a></li><li><a class="tocitem" href="../../estimation/multistart/">Multistart</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Uncertainty Quantification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../uncertainty-quantification/">Overview</a></li><li><a class="tocitem" href="../../uncertainty-quantification/wald/">Wald</a></li><li><a class="tocitem" href="../../uncertainty-quantification/profile-likelihood/">Profile likelihood</a></li><li><a class="tocitem" href="../../uncertainty-quantification/mcmc-based-uncertainty/">MCMC-based uncertainty</a></li></ul></li><li><a class="tocitem" href="../../plotting/">Plotting</a></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox" checked/><label class="tocitem" for="menuitem-9"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../mixed-effects-multiple-methods/">Mixed-Effects Tutorial 1: Nonlinear Random-Effects Model Across Multiple Estimation Methods</a></li><li><a class="tocitem" href="../mixed-effects-ode-mcem/">Mixed-Effects Tutorial 2: ODE Model with Dosing Events (MCEM)</a></li><li><a class="tocitem" href="../mixed-effects-nn-saem/">Mixed-Effects Tutorial 3: Neural Differential-Equation Components (SAEM)</a></li><li><a class="tocitem" href="../mixed-effects-softtree-saem/">Mixed-Effects Tutorial 4: SoftTree Differential-Equation Components (SAEM)</a></li><li><a class="tocitem" href="../mixed-effects-seizure-counts-poisson-nb-mcem/">Mixed-Effects Tutorial 5: Seizure Counts with Poisson and NegativeBinomial Outcomes (MCEM)</a></li><li><a class="tocitem" href="../mixed-effects-left-censored-virload50-laplace/">Mixed-Effects Tutorial 6: Left-Censored Nonlinear Model (Laplace)</a></li><li class="is-active"><a class="tocitem" href>Mixed-Effects Tutorial 7: Variational Inference (VI)</a><ul class="internal"><li><a class="tocitem" href="#Learning-Goals"><span>Learning Goals</span></a></li><li><a class="tocitem" href="#Step-1:-Data-Setup"><span>Step 1: Data Setup</span></a></li><li><a class="tocitem" href="#Step-2:-Define-the-Mixed-Effects-Model"><span>Step 2: Define the Mixed-Effects Model</span></a></li><li><a class="tocitem" href="#Step-3:-Build-DataModel-and-Configure-VI"><span>Step 3: Build <code>DataModel</code> and Configure VI</span></a></li><li><a class="tocitem" href="#Step-4:-Fit-and-Inspect-Core-Summary"><span>Step 4: Fit and Inspect Core Summary</span></a></li><li><a class="tocitem" href="#Step-5:-Posterior-Coordinates-and-Random-Effects"><span>Step 5: Posterior Coordinates and Random Effects</span></a></li><li><a class="tocitem" href="#Step-6:-Chain-Style-UQ"><span>Step 6: Chain-Style UQ</span></a></li><li><a class="tocitem" href="#Step-7:-Posterior-Based-Diagnostic-Plots"><span>Step 7: Posterior-Based Diagnostic Plots</span></a></li><li><a class="tocitem" href="#Step-8:-Optional-–-Condition-on-Fixed-Effect-Estimates"><span>Step 8: Optional – Condition on Fixed-Effect Estimates</span></a></li><li><a class="tocitem" href="#Interpretation-Notes"><span>Interpretation Notes</span></a></li></ul></li><li><a class="tocitem" href="../fixed-effects-nonlinear-mle-map/">Fixed-Effects Tutorial 1: Nonlinear Longitudinal Model (MLE + MAP)</a></li><li><a class="tocitem" href="../fixed-effects-vi/">Fixed-Effects Tutorial 2: Variational Inference (VI)</a></li></ul></li><li><a class="tocitem" href="../../how-to-contribute/">How to Contribute</a></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Mixed-Effects Tutorial 7: Variational Inference (VI)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mixed-Effects Tutorial 7: Variational Inference (VI)</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/manuhuth/NoLimits.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/manuhuth/NoLimits.jl/blob/main/docs/src/tutorials/mixed-effects-vi.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Mixed-Effects-Tutorial-7:-Variational-Inference-(VI)-for-Longitudinal-Growth"><a class="docs-heading-anchor" href="#Mixed-Effects-Tutorial-7:-Variational-Inference-(VI)-for-Longitudinal-Growth">Mixed-Effects Tutorial 7: Variational Inference (VI) for Longitudinal Growth</a><a id="Mixed-Effects-Tutorial-7:-Variational-Inference-(VI)-for-Longitudinal-Growth-1"></a><a class="docs-heading-anchor-permalink" href="#Mixed-Effects-Tutorial-7:-Variational-Inference-(VI)-for-Longitudinal-Growth" title="Permalink"></a></h1><p>Longitudinal growth studies measure the same individuals repeatedly over time, capturing how a biological quantity evolves under different conditions. The classic <code>ChickWeight</code> dataset from R records the body weights of 50 newly hatched chicks at up to twelve time points over 21 days, with each chick assigned to one of four dietary formulations. The scientific questions are natural: how quickly do chicks grow on average, does diet tier systematically shift the weight trajectory, and how much individual-to-individual variability persists after accounting for diet? A linear mixed-effects model addresses all three questions simultaneously – a population-level growth rate and diet effect captured by fixed effects, and a subject-specific random intercept that absorbs unexplained individual differences.</p><p>Estimating this model requires integrating over the random effects. In this tutorial, you will use <strong>Variational Inference (VI)</strong>, a deterministic alternative to Markov Chain Monte Carlo (MCMC). Rather than drawing exact samples from the posterior, VI optimizes a parameterized family of distributions (here, a full-rank multivariate Normal) to minimize the Kullback–Leibler divergence to the true posterior. When it converges well, VI produces a tractable posterior approximation that can be sampled, summarized, and used for uncertainty quantification at a fraction of the computational cost of MCMC.</p><p>For a mixed-effects model, the VI posterior covers both the fixed-effects parameters and the individual-level random effect values – jointly. This makes VI an especially convenient method when you want approximate Bayesian uncertainty for both population parameters and subject-specific estimates in a single optimization pass.</p><h2 id="Learning-Goals"><a class="docs-heading-anchor" href="#Learning-Goals">Learning Goals</a><a id="Learning-Goals-1"></a><a class="docs-heading-anchor-permalink" href="#Learning-Goals" title="Permalink"></a></h2><p>By the end of this tutorial, you will know how to:</p><ul><li><strong>Prepare longitudinal growth data.</strong> Load and restructure the <code>ChickWeight</code> dataset, encoding diet as an ordinal numeric covariate and enforcing the types and sort order that NoLimits requires.</li><li><strong>Specify a mixed-effects model with a constant covariate.</strong> Define fixed effects for baseline weight, growth slope, and diet effect, plus a Normal random intercept for each chick.</li><li><strong>Fit with VI.</strong> Run <code>fit_model</code> with a <code>VI</code> method configuration and inspect the ELBO value and convergence status.</li><li><strong>Inspect the joint variational posterior.</strong> Use <code>sample_posterior</code> to draw from the variational approximation and examine which posterior coordinates correspond to fixed effects and which to random effects.</li><li><strong>Quantify uncertainty with chain-style UQ.</strong> Use <code>compute_uq(...; method=:chain)</code> to propagate variational posterior samples into credible intervals for all fixed-effects parameters.</li><li><strong>Produce posterior-aware diagnostic plots.</strong> Generate fitted-trajectory plots, random-effect distribution plots, VPC plots, and residual QQ plots using the same APIs available for MCMC.</li></ul><h2 id="Step-1:-Data-Setup"><a class="docs-heading-anchor" href="#Step-1:-Data-Setup">Step 1: Data Setup</a><a id="Step-1:-Data-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Step-1:-Data-Setup" title="Permalink"></a></h2><p>In this step, you will load the <code>ChickWeight</code> dataset from the Rdatasets mirror and prepare it for modelling. The preprocessing operations are: converting the chick identifier to a string (NoLimits requires grouping IDs to be comparable with <code>==</code>); enforcing <code>Float64</code> types on the time and weight columns; constructing a numeric diet covariate <code>diet_num</code> by subtracting 1 from the integer diet label so that Diet 1 maps to 0.0, Diet 2 to 1.0, and so on; and sorting by chick and time. The summary printed at the end gives a quick overview of the dataset&#39;s scale before modelling.</p><pre><code class="language-julia hljs">using NoLimits
using CSV
using DataFrames
using Distributions
using Downloads
using Random

include(joinpath(@__DIR__, &quot;_data_loaders.jl&quot;))

Random.seed!(2026)

df = load_chickweight()
select!(df, [:Chick, :Time, :weight, :Diet])
df.Chick    = string.(df.Chick)
df.Time     = Float64.(df.Time)
df.weight   = Float64.(df.weight)
df.diet_num = Float64.(df.Diet .- 1)   # 0.0 = Diet 1, 1.0 = Diet 2, 2.0 = Diet 3, 3.0 = Diet 4
sort!(df, [:Chick, :Time])

(
    n_rows       = nrow(df),
    n_chicks     = length(unique(df.Chick)),
    n_diets      = length(unique(df.Diet)),
    time_range   = extrema(df.Time),
    weight_range = extrema(df.weight),
)</code></pre><h2 id="Step-2:-Define-the-Mixed-Effects-Model"><a class="docs-heading-anchor" href="#Step-2:-Define-the-Mixed-Effects-Model">Step 2: Define the Mixed-Effects Model</a><a id="Step-2:-Define-the-Mixed-Effects-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Step-2:-Define-the-Mixed-Effects-Model" title="Permalink"></a></h2><p>In this step, you will specify a linear mixed-effects model for chick growth. The population-level mean weight for chick <span>$i$</span> at time <span>$t$</span> is:</p><p class="math-container">\[\mu_{it} = \alpha + \beta \cdot t + \gamma \cdot d_i + \eta_i,\]</p><p>where <span>$\alpha$</span> is the population intercept (expected weight at day 0 for a Diet-1 chick), <span>$\beta$</span> is the daily growth rate shared across all individuals, <span>$\gamma$</span> is the additive diet effect per diet tier above tier 1, <span>$d_i \in \{0, 1, 2, 3\}$</span> is the constant diet-level covariate for chick <span>$i$</span>, and <span>$\eta_i \sim \text{Normal}(0, \omega)$</span> is a subject-specific random intercept that captures unexplained baseline weight variation.</p><p>The observation model is <span>$\text{weight}_{it} \sim \text{Normal}(\mu_{it}, \sigma)$</span>, where <span>$\sigma$</span> is the residual standard deviation.</p><p>All five fixed-effects parameters are assigned weakly informative priors consistent with the observed weight range (roughly 35–380 g over 21 days). The positive variance parameters <span>$\omega$</span> and <span>$\sigma$</span> are estimated on the log scale and given LogNormal priors; the regression coefficients <span>$\alpha$</span>, <span>$\beta$</span>, and <span>$\gamma$</span> are estimated on the identity scale with Normal priors wide enough to let the data dominate.</p><pre><code class="language-julia hljs">model = @Model begin
    @covariates begin
        Time     = Covariate()
        diet_num = ConstantCovariate(; constant_on=:Chick)
    end

    @fixedEffects begin
        alpha = RealNumber(45.0, prior=Normal(45.0, 20.0))
        beta  = RealNumber(8.0,  prior=Normal(8.0,  4.0))
        gamma = RealNumber(8.0,  prior=Normal(0.0,  15.0))
        omega = RealNumber(20.0, scale=:log, prior=LogNormal(3.0, 0.5))
        sigma = RealNumber(15.0, scale=:log, prior=LogNormal(2.7, 0.5))
    end

    @randomEffects begin
        eta = RandomEffect(Normal(0.0, omega); column=:Chick)
    end

    @formulas begin
        mu = alpha + beta * Time + gamma * diet_num + eta
        weight ~ Normal(mu, sigma)
    end
end

NoLimits.summarize(model)</code></pre><h2 id="Step-3:-Build-DataModel-and-Configure-VI"><a class="docs-heading-anchor" href="#Step-3:-Build-DataModel-and-Configure-VI">Step 3: Build <code>DataModel</code> and Configure VI</a><a id="Step-3:-Build-DataModel-and-Configure-VI-1"></a><a class="docs-heading-anchor-permalink" href="#Step-3:-Build-DataModel-and-Configure-VI" title="Permalink"></a></h2><p>In this step, you will bind the model to the dataset and configure the variational inference method.</p><p>The <code>DataModel</code> constructor validates the schema (checking that <code>Chick</code>, <code>Time</code>, <code>weight</code>, and <code>diet_num</code> are all present and correctly typed), groups observations by chick, and assembles the internal data structures needed for estimation. Calling <code>NoLimits.summarize</code> on the constructed data model is a useful sanity check: it reports the number of individuals, the RE grouping structure, and the covariate types.</p><p>Variational Inference in NoLimits is powered by Turing.jl&#39;s <code>vi</code> engine. The two key configuration choices are the <strong>variational family</strong> and <strong><code>max_iter</code></strong>. The <code>:fullrank</code> family uses a full-covariance multivariate Normal approximation over all latent variables, capturing posterior correlations between fixed effects and random effects that are typical in hierarchical models. The <code>:meanfield</code> family uses a factorized approximation that is faster but ignores these correlations and can underestimate posterior uncertainty. For a mixed-effects model with 50 chick-level random effects and 5 fixed-effects parameters, <code>:fullrank</code> is the more faithful choice.</p><pre><code class="language-julia hljs">dm = DataModel(model, df; primary_id=:Chick, time_col=:Time)

vi_method = VI(; turing_kwargs=(max_iter=600, family=:fullrank, progress=false))

NoLimits.summarize(dm)</code></pre><h2 id="Step-4:-Fit-and-Inspect-Core-Summary"><a class="docs-heading-anchor" href="#Step-4:-Fit-and-Inspect-Core-Summary">Step 4: Fit and Inspect Core Summary</a><a id="Step-4:-Fit-and-Inspect-Core-Summary-1"></a><a class="docs-heading-anchor-permalink" href="#Step-4:-Fit-and-Inspect-Core-Summary" title="Permalink"></a></h2><p>Running <code>fit_model</code> optimizes the variational parameters (the mean and covariance of the multivariate Normal approximation) by maximizing the Evidence Lower BOund (ELBO) with stochastic gradient ascent. The ELBO is a lower bound on the log marginal likelihood; maximizing it pushes the variational distribution to be as close as possible to the true posterior while keeping it analytically tractable. The reported objective is the final ELBO value.</p><pre><code class="language-julia hljs">res_vi = fit_model(
    dm,
    vi_method;
    rng=Random.Xoshiro(20),
)

NoLimits.summarize(res_vi)</code></pre><p>You can also directly inspect the convergence flag and ELBO trace to confirm that optimization did not terminate prematurely:</p><pre><code class="language-julia hljs">get_converged(res_vi)
get_vi_trace(res_vi)</code></pre><p>A rising ELBO trace that flattens toward the final iteration is the expected signature of well-behaved convergence. If the trace is still noticeably increasing at the last step, consider increasing <code>max_iter</code>.</p><h2 id="Step-5:-Posterior-Coordinates-and-Random-Effects"><a class="docs-heading-anchor" href="#Step-5:-Posterior-Coordinates-and-Random-Effects">Step 5: Posterior Coordinates and Random Effects</a><a id="Step-5:-Posterior-Coordinates-and-Random-Effects-1"></a><a class="docs-heading-anchor-permalink" href="#Step-5:-Posterior-Coordinates-and-Random-Effects" title="Permalink"></a></h2><p>The variational posterior is a joint distribution over all latent variables: the five fixed-effects parameters and the 50 chick-level random effects. <code>sample_posterior</code> draws from this approximation and, when <code>return_names=true</code>, returns the coordinate names alongside the draws so you can identify which dimensions correspond to which quantities.</p><pre><code class="language-julia hljs">draws_named = sample_posterior(
    res_vi;
    n_draws=200,
    rng=Random.Xoshiro(21),
    return_names=true,
)

size(draws_named.draws), first(draws_named.names, 8)</code></pre><p>The first five coordinates in <code>draws_named.names</code> are the transformed fixed-effects parameters (<code>alpha</code>, <code>beta</code>, <code>gamma</code>, <code>omega</code>, <code>sigma</code>). The remaining 50 coordinates are the chick-level random-effect values <code>eta_vals[1]</code>, ..., <code>eta_vals[50]</code>, one per chick in the order they appear in the dataset. Examining these joint draws directly – or computing per-chick posterior means and standard deviations – reveals both population-level uncertainty and subject-specific uncertainty in a single posterior object.</p><h2 id="Step-6:-Chain-Style-UQ"><a class="docs-heading-anchor" href="#Step-6:-Chain-Style-UQ">Step 6: Chain-Style UQ</a><a id="Step-6:-Chain-Style-UQ-1"></a><a class="docs-heading-anchor-permalink" href="#Step-6:-Chain-Style-UQ" title="Permalink"></a></h2><p>For VI fits, credible intervals are constructed by treating posterior samples as a pseudo-chain. The <code>method=:chain</code> option draws <code>mcmc_draws</code> samples from the variational posterior and uses their empirical quantiles to form credible intervals. This approach is API-compatible with the MCMC-based UQ workflow, so the same summarization and plotting functions work for both sampling-based and variational methods.</p><pre><code class="language-julia hljs">uq_vi = compute_uq(
    res_vi;
    method=:chain,
    level=0.95,
    mcmc_draws=200,
    rng=Random.Xoshiro(22),
)

NoLimits.summarize(res_vi, uq_vi)</code></pre><p>The combined summary table shows point estimates alongside 95% credible interval bounds for each fixed-effects parameter. A narrow interval for <code>beta</code> confirms that the population growth rate is well-identified by the data. A positive <code>gamma</code> with an interval clearly above zero provides evidence that higher diet tiers are associated with heavier weights, after accounting for individual variation.</p><h2 id="Step-7:-Posterior-Based-Diagnostic-Plots"><a class="docs-heading-anchor" href="#Step-7:-Posterior-Based-Diagnostic-Plots">Step 7: Posterior-Based Diagnostic Plots</a><a id="Step-7:-Posterior-Based-Diagnostic-Plots-1"></a><a class="docs-heading-anchor-permalink" href="#Step-7:-Posterior-Based-Diagnostic-Plots" title="Permalink"></a></h2><p>A key advantage of VI over point-estimate methods (MLE, MAP) is that the posterior approximation can propagate uncertainty into all downstream visualizations. The following four plots each draw <code>mcmc_draws</code> posterior samples from the variational posterior and use them to construct credible bands, predictive distributions, and calibration diagnostics.</p><pre><code class="language-julia hljs">p_fit_vi = plot_fits(
    res_vi;
    observable=:weight,
    individuals_idx=[1, 2, 3, 4, 5, 6],
    ncols=3,
    plot_mcmc_quantiles=true,
    mcmc_draws=150,
)

p_re_vi = plot_random_effect_distributions(
    res_vi;
    mcmc_draws=150,
)

p_vpc_vi = plot_vpc(
    res_vi;
    n_simulations=50,
    n_bins=4,
    mcmc_draws=150,
    rng=Random.Xoshiro(23),
)

p_qq_vi = plot_residual_qq(
    res_vi;
    residual=:quantile,
    mcmc_draws=150,
)</code></pre><p>Fitted trajectories with posterior credible bands (6 chicks):</p><pre><code class="language-julia hljs">p_fit_vi</code></pre><p>Marginal posterior distribution of the random effects across all 50 chicks:</p><pre><code class="language-julia hljs">p_re_vi</code></pre><p>Visual Predictive Check – do model-simulated trajectories bracket the observed data in the expected proportions?</p><pre><code class="language-julia hljs">p_vpc_vi</code></pre><p>Residual quantile-quantile plot for overall calibration assessment:</p><pre><code class="language-julia hljs">p_qq_vi</code></pre><h2 id="Step-8:-Optional-–-Condition-on-Fixed-Effect-Estimates"><a class="docs-heading-anchor" href="#Step-8:-Optional-–-Condition-on-Fixed-Effect-Estimates">Step 8: Optional – Condition on Fixed-Effect Estimates</a><a id="Step-8:-Optional-–-Condition-on-Fixed-Effect-Estimates-1"></a><a class="docs-heading-anchor-permalink" href="#Step-8:-Optional-–-Condition-on-Fixed-Effect-Estimates" title="Permalink"></a></h2><p>When fixed-effect values have been established from a prior analysis (for example, a MAP fit), you can hold them constant and run VI exclusively over the random effects. The <code>constants</code> argument pins specified fixed effects at given values on the <strong>transformed</strong> scale, removing them from the optimizer&#39;s parameter space. For identity-scale parameters (<code>alpha</code>, <code>beta</code>, <code>gamma</code>) the transformed value equals the natural value; for log-scale parameters (<code>omega</code>, <code>sigma</code>) the transformed value is the logarithm.</p><pre><code class="language-julia hljs">res_re_only = fit_model(
    dm,
    VI(; turing_kwargs=(max_iter=300, progress=false)),
    constants=(alpha=45.0, beta=8.0, gamma=8.0, omega=log(20.0), sigma=log(15.0)),
    rng=Random.Xoshiro(24),
)</code></pre><p>This conditional RE-only fit is useful for sensitivity analyses or plug-in empirical Bayes workflows where you trust the point estimates of the population parameters but still want approximate posterior uncertainty over individual-level effects.</p><h2 id="Interpretation-Notes"><a class="docs-heading-anchor" href="#Interpretation-Notes">Interpretation Notes</a><a id="Interpretation-Notes-1"></a><a class="docs-heading-anchor-permalink" href="#Interpretation-Notes" title="Permalink"></a></h2><ul><li><strong>Why VI for mixed effects?</strong> MCMC scales poorly with the number of random effects because each subject introduces additional latent dimensions that the sampler must explore. VI collapses this exploration into an optimization problem, making it faster and more predictable while still providing an approximate posterior. For datasets with tens or hundreds of subjects, VI is often the most practical approximate Bayesian method.</li><li><strong>Fullrank vs. meanfield.</strong> The full-rank variational family captures correlations between fixed and random effects – for example, the negative correlation between the population intercept <span>$\alpha$</span> and individual random effects <span>$\eta_i$</span> that arises because a higher <span>$\alpha$</span> requires smaller <span>$\eta_i$</span> values to explain the same observations. Meanfield VI ignores these correlations and can underestimate posterior variance or misrepresent marginal parameter distributions. For hierarchical models, fullrank is generally preferred when the additional computational cost is acceptable.</li><li><strong>VI tends to underestimate posterior variance.</strong> Because VI minimizes the reverse KL divergence (which is mass-seeking rather than mass-covering), the variational approximation often produces credible intervals that are somewhat narrower than those from MCMC. If you observe suspiciously narrow intervals, consider running an MCMC sampler on the same model as a reference comparison.</li><li><strong>Linear model as a starting point.</strong> The linear growth model used here is a deliberate simplification: chick growth is not strictly linear over 21 days, and residual plots may show some curvature at later time points. Nonlinear alternatives – logistic growth, Gompertz curves – would better capture the decelerating growth phase but require a <code>@DifferentialEquation</code> or a closed-form nonlinear <code>@formulas</code> block. The VI workflow demonstrated here extends naturally to those more complex specifications.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mixed-effects-left-censored-virload50-laplace/">« Mixed-Effects Tutorial 6: Left-Censored Nonlinear Model (Laplace)</a><a class="docs-footer-nextpage" href="../fixed-effects-nonlinear-mle-map/">Fixed-Effects Tutorial 1: Nonlinear Longitudinal Model (MLE + MAP) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Friday 20 February 2026 21:10">Friday 20 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
