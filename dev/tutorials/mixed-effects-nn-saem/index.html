<!DOCTYPE html>
<html lang="en"><head><meta charset="UTF-8"/><meta name="viewport" content="width=device-width, initial-scale=1.0"/><title>Mixed-Effects Tutorial 3: Neural Differential-Equation Components (SAEM) · NoLimits.jl</title><meta name="title" content="Mixed-Effects Tutorial 3: Neural Differential-Equation Components (SAEM) · NoLimits.jl"/><meta property="og:title" content="Mixed-Effects Tutorial 3: Neural Differential-Equation Components (SAEM) · NoLimits.jl"/><meta property="twitter:title" content="Mixed-Effects Tutorial 3: Neural Differential-Equation Components (SAEM) · NoLimits.jl"/><meta name="description" content="Documentation for NoLimits.jl."/><meta property="og:description" content="Documentation for NoLimits.jl."/><meta property="twitter:description" content="Documentation for NoLimits.jl."/><script data-outdated-warner src="../../assets/warner.js"></script><link href="https://cdnjs.cloudflare.com/ajax/libs/lato-font/3.0.0/css/lato-font.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/juliamono/0.050/juliamono.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/fontawesome.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/solid.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.2/css/brands.min.css" rel="stylesheet" type="text/css"/><link href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.16.8/katex.min.css" rel="stylesheet" type="text/css"/><script>documenterBaseURL="../.."</script><script src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.6/require.min.js" data-main="../../assets/documenter.js"></script><script src="../../search_index.js"></script><script src="../../siteinfo.js"></script><script src="../../../versions.js"></script><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-mocha.css" data-theme-name="catppuccin-mocha"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-macchiato.css" data-theme-name="catppuccin-macchiato"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-frappe.css" data-theme-name="catppuccin-frappe"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/catppuccin-latte.css" data-theme-name="catppuccin-latte"/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-dark.css" data-theme-name="documenter-dark" data-theme-primary-dark/><link class="docs-theme-link" rel="stylesheet" type="text/css" href="../../assets/themes/documenter-light.css" data-theme-name="documenter-light" data-theme-primary/><script src="../../assets/themeswap.js"></script></head><body><div id="documenter"><nav class="docs-sidebar"><a class="docs-logo" href="../../"><img src="../../assets/logo.png" alt="NoLimits.jl logo"/></a><button class="docs-search-query input is-rounded is-small is-clickable my-2 mx-auto py-1 px-2" id="documenter-search-query">Search docs (Ctrl + /)</button><ul class="docs-menu"><li><a class="tocitem" href="../../">Home</a></li><li><a class="tocitem" href="../../installation/">Installation</a></li><li><a class="tocitem" href="../../capabilities/">Capabilities</a></li><li><input class="collapse-toggle" id="menuitem-4" type="checkbox"/><label class="tocitem" for="menuitem-4"><span class="docs-label">Model Building</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../model-building/">Overview</a></li><li><a class="tocitem" href="../../model-building/model-macro/">@Model</a></li><li><a class="tocitem" href="../../model-building/helpers/">@helpers</a></li><li><a class="tocitem" href="../../model-building/fixed-effects/">@fixedEffects</a></li><li><a class="tocitem" href="../../model-building/covariates/">@covariates</a></li><li><a class="tocitem" href="../../model-building/random-effects/">@randomEffects</a></li><li><a class="tocitem" href="../../model-building/pre-differential-equation/">@preDifferentialEquation</a></li><li><a class="tocitem" href="../../model-building/differential-equation/">@DifferentialEquation</a></li><li><a class="tocitem" href="../../model-building/initial-de/">@initialDE</a></li><li><a class="tocitem" href="../../model-building/formulas/">@formulas</a></li><li><a class="tocitem" href="../../model-building/universal-function-approximators/">Function Approximators (NNs + SoftTrees)</a></li></ul></li><li><a class="tocitem" href="../../data-model-construction/">Data Model Construction</a></li><li><input class="collapse-toggle" id="menuitem-6" type="checkbox"/><label class="tocitem" for="menuitem-6"><span class="docs-label">Estimation</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../estimation/">Overview</a></li><li><a class="tocitem" href="../../estimation/laplace/">Laplace</a></li><li><a class="tocitem" href="../../estimation/laplace-map/">Laplace MAP</a></li><li><a class="tocitem" href="../../estimation/mcem/">MCEM</a></li><li><a class="tocitem" href="../../estimation/saem/">SAEM</a></li><li><a class="tocitem" href="../../estimation/mcmc/">MCMC</a></li><li><a class="tocitem" href="../../estimation/mle/">MLE</a></li><li><a class="tocitem" href="../../estimation/mle-map/">MAP</a></li><li><a class="tocitem" href="../../estimation/multistart/">Multistart</a></li></ul></li><li><input class="collapse-toggle" id="menuitem-7" type="checkbox"/><label class="tocitem" for="menuitem-7"><span class="docs-label">Uncertainty Quantification</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../../uncertainty-quantification/">Overview</a></li><li><a class="tocitem" href="../../uncertainty-quantification/wald/">Wald</a></li><li><a class="tocitem" href="../../uncertainty-quantification/profile-likelihood/">Profile likelihood</a></li><li><a class="tocitem" href="../../uncertainty-quantification/mcmc-based-uncertainty/">MCMC-based uncertainty</a></li></ul></li><li><a class="tocitem" href="../../plotting/">Plotting</a></li><li><input class="collapse-toggle" id="menuitem-9" type="checkbox" checked/><label class="tocitem" for="menuitem-9"><span class="docs-label">Tutorials</span><i class="docs-chevron"></i></label><ul class="collapsed"><li><a class="tocitem" href="../mixed-effects-multiple-methods/">Mixed-Effects Tutorial 1: Nonlinear Random-Effects Model Across Multiple Estimation Methods</a></li><li><a class="tocitem" href="../mixed-effects-ode-mcem/">Mixed-Effects Tutorial 2: ODE Model with Dosing Events (MCEM)</a></li><li class="is-active"><a class="tocitem" href>Mixed-Effects Tutorial 3: Neural Differential-Equation Components (SAEM)</a><ul class="internal"><li><a class="tocitem" href="#Learning-Goals"><span>Learning Goals</span></a></li><li><a class="tocitem" href="#Step-1:-Data-Setup"><span>Step 1: Data Setup</span></a></li><li><a class="tocitem" href="#Step-2:-Define-the-Neural-ODE-Mixed-Effects-Model"><span>Step 2: Define the Neural ODE Mixed-Effects Model</span></a></li><li><a class="tocitem" href="#Step-3:-Build-the-DataModel-and-Configure-SAEM"><span>Step 3: Build the <code>DataModel</code> and Configure SAEM</span></a></li><li><a class="tocitem" href="#Step-4:-Fit-the-Model-and-Inspect-Results"><span>Step 4: Fit the Model and Inspect Results</span></a></li><li><a class="tocitem" href="#Step-5:-Visualize-Fitted-Trajectories"><span>Step 5: Visualize Fitted Trajectories</span></a></li><li><a class="tocitem" href="#Step-6:-Inspect-the-Observation-Distribution"><span>Step 6: Inspect the Observation Distribution</span></a></li><li><a class="tocitem" href="#Interpretation-Notes"><span>Interpretation Notes</span></a></li></ul></li><li><a class="tocitem" href="../mixed-effects-softtree-saem/">Mixed-Effects Tutorial 4: SoftTree Differential-Equation Components (SAEM)</a></li><li><a class="tocitem" href="../mixed-effects-seizure-counts-poisson-nb-mcem/">Mixed-Effects Tutorial 5: Seizure Counts with Poisson and NegativeBinomial Outcomes (MCEM)</a></li><li><a class="tocitem" href="../mixed-effects-left-censored-virload50-laplace/">Mixed-Effects Tutorial 6: Left-Censored Nonlinear Model (Laplace)</a></li><li><a class="tocitem" href="../fixed-effects-nonlinear-mle-map/">Fixed-Effects Tutorial 1: Nonlinear Longitudinal Model (MLE + MAP)</a></li></ul></li><li><a class="tocitem" href="../../how-to-contribute/">How to Contribute</a></li><li><a class="tocitem" href="../../api/">API</a></li></ul><div class="docs-version-selector field has-addons"><div class="control"><span class="docs-label button is-static is-size-7">Version</span></div><div class="docs-selector control is-expanded"><div class="select is-fullwidth is-size-7"><select id="documenter-version-selector"></select></div></div></div></nav><div class="docs-main"><header class="docs-navbar"><a class="docs-sidebar-button docs-navbar-link fa-solid fa-bars is-hidden-desktop" id="documenter-sidebar-button" href="#"></a><nav class="breadcrumb"><ul class="is-hidden-mobile"><li><a class="is-disabled">Tutorials</a></li><li class="is-active"><a href>Mixed-Effects Tutorial 3: Neural Differential-Equation Components (SAEM)</a></li></ul><ul class="is-hidden-tablet"><li class="is-active"><a href>Mixed-Effects Tutorial 3: Neural Differential-Equation Components (SAEM)</a></li></ul></nav><div class="docs-right"><a class="docs-navbar-link" href="https://github.com/manuhuth/NoLimits.jl" title="View the repository on GitHub"><span class="docs-icon fa-brands"></span><span class="docs-label is-hidden-touch">GitHub</span></a><a class="docs-navbar-link" href="https://github.com/manuhuth/NoLimits.jl/blob/main/docs/src/tutorials/mixed-effects-nn-saem.md" title="Edit source on GitHub"><span class="docs-icon fa-solid"></span></a><a class="docs-settings-button docs-navbar-link fa-solid fa-gear" id="documenter-settings-button" href="#" title="Settings"></a><a class="docs-article-toggle-button fa-solid fa-chevron-up" id="documenter-article-toggle-button" href="javascript:;" title="Collapse all docstrings"></a></div></header><article class="content" id="documenter-page"><h1 id="Mixed-Effects-Tutorial-3:-Neural-Differential-Equation-Components-(SAEM)"><a class="docs-heading-anchor" href="#Mixed-Effects-Tutorial-3:-Neural-Differential-Equation-Components-(SAEM)">Mixed-Effects Tutorial 3: Neural Differential-Equation Components (SAEM)</a><a id="Mixed-Effects-Tutorial-3:-Neural-Differential-Equation-Components-(SAEM)-1"></a><a class="docs-heading-anchor-permalink" href="#Mixed-Effects-Tutorial-3:-Neural-Differential-Equation-Components-(SAEM)" title="Permalink"></a></h1><p>In many scientific domains – from systems biology to chemical engineering to ecology – we understand the broad structure of a dynamical system (e.g., compartments connected by transfer rates) but lack precise knowledge of every rate law or interaction term. Neural ordinary differential equations (Neural ODEs) offer a principled way to address this gap: they embed small neural networks directly inside an ODE system, allowing the data to shape the functional forms that mechanistic reasoning alone cannot specify. Crucially, this approach preserves the interpretable compartmental structure while letting learned components capture the unknown nonlinearities.</p><p>In this tutorial, you will build a mixed-effects ODE model in which multiple neural-network components parameterize the ODE right-hand side, and fit it with the Stochastic Approximation Expectation-Maximization (SAEM) algorithm. By the end, you will have a working example of a hybrid mechanistic-neural model that accounts for between-subject variability through random effects on the network weights themselves.</p><h2 id="Learning-Goals"><a class="docs-heading-anchor" href="#Learning-Goals">Learning Goals</a><a id="Learning-Goals-1"></a><a class="docs-heading-anchor-permalink" href="#Learning-Goals" title="Permalink"></a></h2><p>By the end of this tutorial, you will be able to:</p><ul><li><strong>Declare neural-network parameter blocks</strong> (<code>NNParameters</code>) and wire them into an ODE system using the <code>@DifferentialEquation</code> macro.</li><li><strong>Couple network weights to subject-level random effects</strong> via multivariate normal distributions, so that every individual in the dataset receives a personalized version of the dynamics.</li><li><strong>Fit the model using SAEM</strong> with Gaussian-block closed-form updates, a strategy that improves stability when random-effect dimensions are high.</li><li><strong>Visualize and diagnose</strong> the fitted trajectories and observation distributions.</li></ul><h2 id="Step-1:-Data-Setup"><a class="docs-heading-anchor" href="#Step-1:-Data-Setup">Step 1: Data Setup</a><a id="Step-1:-Data-Setup-1"></a><a class="docs-heading-anchor-permalink" href="#Step-1:-Data-Setup" title="Permalink"></a></h2><p>In this step, you will load and prepare the data. We use the classic Theophylline dataset, which records concentration-time profiles for 12 subjects after oral administration. Although this dataset originates from pharmacology, the underlying dynamics – a substance entering a depot compartment and transferring to a central compartment where it is observed and cleared – are a standard example of a two-compartment transfer system that arises across many fields, from tracer kinetics to nutrient cycling. You will reshape the data into a flat format where the initial amount <code>d</code> enters as a constant covariate.</p><pre><code class="language-julia hljs">using NoLimits
using CSV
using DataFrames
using Distributions
using Downloads
using Random
using LinearAlgebra
using OrdinaryDiffEq
using SciMLBase
using Lux
using Turing

include(joinpath(@__DIR__, &quot;_data_loaders.jl&quot;))

Random.seed!(321)

theoph_df = load_theoph()

function build_theoph_non_event_df(tbl::DataFrame)
    df = DataFrame(
        ID=Int.(tbl.Subject),
        t=Float64.(tbl.Time),
        y=Float64.(tbl.conc),
        d=Float64.(tbl.Wt .* tbl.Dose),
    )
    sort!(df, [:ID, :t])
    return df
end

df = build_theoph_non_event_df(theoph_df)
first(df, 10)</code></pre><h2 id="Step-2:-Define-the-Neural-ODE-Mixed-Effects-Model"><a class="docs-heading-anchor" href="#Step-2:-Define-the-Neural-ODE-Mixed-Effects-Model">Step 2: Define the Neural ODE Mixed-Effects Model</a><a id="Step-2:-Define-the-Neural-ODE-Mixed-Effects-Model-1"></a><a class="docs-heading-anchor-permalink" href="#Step-2:-Define-the-Neural-ODE-Mixed-Effects-Model" title="Permalink"></a></h2><p>In this step, you will define the core model. The key idea is that instead of specifying closed-form rate functions (such as first-order kinetics), you let neural networks learn these functions directly from data. Each <code>NNParameters</code> block declares a small feedforward network whose flattened weights become part of the fixed-effects parameter vector. At evaluation time, a callable function (e.g., <code>NNA1</code>) reconstructs the network from its weight vector and evaluates it – so you can use it inside <code>@DifferentialEquation</code> just like any other function.</p><p>The ODE right-hand side uses four neural components arranged in a two-compartment transfer system:</p><ul><li><code>fA1(t)</code> and <code>fA2(t)</code> govern the dynamics of the depot (input) compartment.</li><li><code>fC1(t)</code> and <code>fC2(t)</code> govern the dynamics of the central (observed) compartment.</li></ul><p>To capture between-subject variability, each network&#39;s weight vector is paired with a subject-level random-effect vector (<code>etaA1</code>, <code>etaA2</code>, <code>etaC1</code>, <code>etaC2</code>) drawn from a <code>MvNormal</code> distribution centered on the population weights. This means every individual effectively receives their own personalized network: the population learns shared structure, while the random effects allow individual departures.</p><pre><code class="language-julia hljs">using NoLimits
using Distributions
using LinearAlgebra
using OrdinaryDiffEq
using Lux

width_nn = 2
chain_A1 = Lux.Chain(Lux.Dense(1, width_nn, tanh), Lux.Dense(width_nn, 1))
chain_A2 = Lux.Chain(Lux.Dense(1, width_nn, tanh), Lux.Dense(width_nn, 1))
chain_C1 = Lux.Chain(Lux.Dense(1, width_nn, tanh), Lux.Dense(width_nn, 1))
chain_C2 = Lux.Chain(Lux.Dense(1, width_nn, tanh), Lux.Dense(width_nn, 1))

model_raw = @Model begin
    @helpers begin
        softplus(u) = u &gt; 20 ? u : log1p(exp(u))
    end

    @covariates begin
        t = Covariate()
        d = ConstantCovariate(constant_on=:ID)
    end

    @fixedEffects begin
        sigma = RealNumber(1.0, scale=:log, prior=LogNormal(log(1.0), 0.5), calculate_se=true)

        zA1 = NNParameters(chain_A1; function_name=:NNA1, calculate_se=false)
        zA2 = NNParameters(chain_A2; function_name=:NNA2, calculate_se=false)
        zC1 = NNParameters(chain_C1; function_name=:NNC1, calculate_se=false)
        zC2 = NNParameters(chain_C2; function_name=:NNC2, calculate_se=false)
    end

    @randomEffects begin
        etaA1 = RandomEffect(MvNormal(zA1, Diagonal(ones(length(zA1)))); column=:ID)
        etaA2 = RandomEffect(MvNormal(zA2, Diagonal(ones(length(zA2)))); column=:ID)
        etaC1 = RandomEffect(MvNormal(zC1, Diagonal(ones(length(zC1)))); column=:ID)
        etaC2 = RandomEffect(MvNormal(zC2, Diagonal(ones(length(zC2)))); column=:ID)
    end

    @DifferentialEquation begin
        a_A(t) = softplus(depot)
        x_C(t) = softplus(center)

        fA1(t) = softplus(NNA1([t / 24], etaA1)[1])
        fA2(t) = softplus(NNA2([a_A(t)], etaA2)[1])
        fC1(t) = -softplus(NNC1([x_C(t)], etaC1)[1])
        fC2(t) = softplus(NNC2([t / 24], etaC2)[1])

        D(depot) ~ -d * fA1(t) - fA2(t)
        D(center) ~ d * fA1(t) + fA2(t) + fC1(t) + d * fC2(t)
    end

    @initialDE begin
        depot = d
        center = 0.0
    end

    @formulas begin
        y ~ Normal(center(t), sigma)
    end
end

model = set_solver_config(
    model_raw;
    saveat_mode=:saveat,
    alg=AutoTsit5(Rosenbrock23()),
    kwargs=(abstol=1e-2, reltol=1e-2),
)</code></pre><p>Before moving on, inspect the model structure to verify that all blocks were assembled correctly.</p><h3 id="Model-Summary"><a class="docs-heading-anchor" href="#Model-Summary">Model Summary</a><a id="Model-Summary-1"></a><a class="docs-heading-anchor-permalink" href="#Model-Summary" title="Permalink"></a></h3><pre><code class="language-julia hljs">model_summary = NoLimits.summarize(model)
model_summary</code></pre><h2 id="Step-3:-Build-the-DataModel-and-Configure-SAEM"><a class="docs-heading-anchor" href="#Step-3:-Build-the-DataModel-and-Configure-SAEM">Step 3: Build the <code>DataModel</code> and Configure SAEM</a><a id="Step-3:-Build-the-DataModel-and-Configure-SAEM-1"></a><a class="docs-heading-anchor-permalink" href="#Step-3:-Build-the-DataModel-and-Configure-SAEM" title="Permalink"></a></h2><p>In this step, you will pair the model with the data by constructing a <code>DataModel</code>, then configure the SAEM algorithm. SAEM alternates between sampling random effects conditional on the current parameter estimates (the E-step) and updating population parameters (the M-step). A key practical detail is the <code>builtin_stats=:closed_form</code> option, which enables built-in closed-form block updates rather than gradient-based optimization for those mapped parameters. This can substantially improve stability when the random-effect dimension is high, as it is here with four separate network weight vectors per subject.</p><p>Two configuration choices deserve attention. First, the <code>re_mean_params</code> mapping tells SAEM which fixed-effect parameter serves as the mean of each random-effect distribution, enabling the closed-form update. Second, the <code>ebe_multistart_n</code> and <code>ebe_multistart_k</code> settings control multistart initialization of the empirical Bayes estimates, helping avoid poor local optima in the early iterations.</p><pre><code class="language-julia hljs">dm = DataModel(model, df; primary_id=:ID, time_col=:t)

saem_method = NoLimits.SAEM(;
    sampler=MH(),
    builtin_stats=:closed_form,
    re_mean_params=(; etaA1=:zA1, etaA2=:zA2, etaC1=:zC1, etaC2=:zC2),
    re_cov_params=NamedTuple(),
    resid_var_param=:sigma,
    maxiters=1000,
    mcmc_steps=80,
    t0=30,
    turing_kwargs=(n_samples=80, n_adapt=0, progress=false),
    optim_kwargs=(maxiters=300,),
    progress=true,
    ebe_multistart_n=300,
    ebe_multistart_k=3,
    ebe_rescue_on_high_grad=false,
    verbose=false,
)

serialization = SciMLBase.EnsembleThreads()</code></pre><p>Before fitting, review the data model summary to confirm that individuals, covariates, and grouping structures were parsed as expected.</p><h3 id="DataModel-Summary"><a class="docs-heading-anchor" href="#DataModel-Summary">DataModel Summary</a><a id="DataModel-Summary-1"></a><a class="docs-heading-anchor-permalink" href="#DataModel-Summary" title="Permalink"></a></h3><pre><code class="language-julia hljs">dm_summary = NoLimits.summarize(dm)
dm_summary</code></pre><h2 id="Step-4:-Fit-the-Model-and-Inspect-Results"><a class="docs-heading-anchor" href="#Step-4:-Fit-the-Model-and-Inspect-Results">Step 4: Fit the Model and Inspect Results</a><a id="Step-4:-Fit-the-Model-and-Inspect-Results-1"></a><a class="docs-heading-anchor-permalink" href="#Step-4:-Fit-the-Model-and-Inspect-Results" title="Permalink"></a></h2><p>You are now ready to run SAEM. The algorithm will iterate up to 1000 times, using Metropolis-Hastings sampling for the random effects within each E-step. After fitting, you will extract the final objective value and the number of estimated parameters as an initial sanity check.</p><pre><code class="language-julia hljs">res_saem = fit_model(
    dm,
    saem_method;
    serialization=serialization,
    rng=Random.Xoshiro(21),
)

(
    objective=NoLimits.get_objective(res_saem),
    n_params=length(NoLimits.get_params(res_saem; scale=:untransformed)),
)</code></pre><p>For a more detailed summary of the fit – including parameter estimates and convergence diagnostics – call the <code>summarize</code> function.</p><pre><code class="language-julia hljs">fit_summary_saem = NoLimits.summarize(res_saem)
fit_summary_saem</code></pre><h2 id="Step-5:-Visualize-Fitted-Trajectories"><a class="docs-heading-anchor" href="#Step-5:-Visualize-Fitted-Trajectories">Step 5: Visualize Fitted Trajectories</a><a id="Step-5:-Visualize-Fitted-Trajectories-1"></a><a class="docs-heading-anchor-permalink" href="#Step-5:-Visualize-Fitted-Trajectories" title="Permalink"></a></h2><p>In this step, you will overlay the model predictions on the raw observations for the first two subjects. Plotting fitted trajectories against observed data provides an immediate visual assessment of model adequacy – you should see the neural ODE tracking the characteristic rise-and-decay pattern of the two-compartment transfer system, with subject-specific variation captured by the random effects.</p><pre><code class="language-julia hljs">p_fit_saem = plot_fits(
    res_saem;
    observable=:y,
    individuals_idx=[1, 2],
    ncols=2,
    shared_x_axis=true,
    shared_y_axis=true,
)

p_fit_saem</code></pre><h2 id="Step-6:-Inspect-the-Observation-Distribution"><a class="docs-heading-anchor" href="#Step-6:-Inspect-the-Observation-Distribution">Step 6: Inspect the Observation Distribution</a><a id="Step-6:-Inspect-the-Observation-Distribution-1"></a><a class="docs-heading-anchor-permalink" href="#Step-6:-Inspect-the-Observation-Distribution" title="Permalink"></a></h2><p>As a final diagnostic, you will examine the implied observation distribution at a single data point for the first individual. This plot shows the full predictive distribution (not just the point estimate), which helps you assess whether the residual variance is well-calibrated and whether the model&#39;s uncertainty is reasonable.</p><pre><code class="language-julia hljs">p_obs_saem = plot_observation_distributions(
    res_saem;
    observables=:y,
    individuals_idx=1,
    obs_rows=1,
)

p_obs_saem</code></pre><h2 id="Interpretation-Notes"><a class="docs-heading-anchor" href="#Interpretation-Notes">Interpretation Notes</a><a id="Interpretation-Notes-1"></a><a class="docs-heading-anchor-permalink" href="#Interpretation-Notes" title="Permalink"></a></h2><ul><li>This modeling pattern combines mechanistic compartmental states with learned nonlinear rate functions inside a single mixed-effects ODE. The compartmental structure encodes known domain knowledge (e.g., mass conservation, transfer between compartments), while the neural networks fill in the unknown functional forms. This hybrid strategy is broadly applicable to any system where the topology is known but the governing laws are not fully specified.</li><li>The built-in closed-form updates (<code>builtin_stats=:closed_form</code>) can materially improve SAEM stability when the random-effect dimension is large, as is typical with neural-network weight vectors.</li><li>The hyperparameter settings used here (network width, iteration counts, tolerance levels) are intentionally modest to keep the tutorial fast. For production analyses, consider increasing <code>maxiters</code>, <code>mcmc_steps</code>, and the number of MCMC samples to ensure thorough convergence, and tightening the ODE solver tolerances.</li></ul></article><nav class="docs-footer"><a class="docs-footer-prevpage" href="../mixed-effects-ode-mcem/">« Mixed-Effects Tutorial 2: ODE Model with Dosing Events (MCEM)</a><a class="docs-footer-nextpage" href="../mixed-effects-softtree-saem/">Mixed-Effects Tutorial 4: SoftTree Differential-Equation Components (SAEM) »</a><div class="flexbox-break"></div><p class="footer-message">Powered by <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> and the <a href="https://julialang.org/">Julia Programming Language</a>.</p></nav></div><div class="modal" id="documenter-settings"><div class="modal-background"></div><div class="modal-card"><header class="modal-card-head"><p class="modal-card-title">Settings</p><button class="delete"></button></header><section class="modal-card-body"><p><label class="label">Theme</label><div class="select"><select id="documenter-themepicker"><option value="auto">Automatic (OS)</option><option value="documenter-light">documenter-light</option><option value="documenter-dark">documenter-dark</option><option value="catppuccin-latte">catppuccin-latte</option><option value="catppuccin-frappe">catppuccin-frappe</option><option value="catppuccin-macchiato">catppuccin-macchiato</option><option value="catppuccin-mocha">catppuccin-mocha</option></select></div></p><hr/><p>This document was generated with <a href="https://github.com/JuliaDocs/Documenter.jl">Documenter.jl</a> version 1.16.1 on <span class="colophon-date" title="Thursday 19 February 2026 23:35">Thursday 19 February 2026</span>. Using Julia version 1.12.5.</p></section><footer class="modal-card-foot"></footer></div></div></div></body></html>
